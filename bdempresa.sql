ALTER SESSION SET "_ORACLE_SCRIPT"=true;
CREATE USER EMPRESA IDENTIFIED BY EMPRESA
DEFAULT TABLESPACE USERS TEMPORARY TABLESPACE TEMP;
GRANT CONNECT, RESOURCE TO EMPRESA;
ALTER USER EMPRESA QUOTA UNLIMITED ON USERS;
CONNECT EMPRESA/EMPRESA;
DROP TABLE DEPART CASCADE CONSTRAINTS; 
DROP TABLE EMPLE CASCADE CONSTRAINTS;
DROP SEQUENCE SECUENCIA;
CREATE TABLE DEPART (
 DEPT_NO  NUMBER(2) NOT NULL,
 DNOMBRE  VARCHAR2(14), 
 LOC      VARCHAR2(14),
CONSTRAINT PK_DEPART PRIMARY KEY(DEPT_NO)) ;

CREATE TABLE EMPLE (
 EMP_NO    NUMBER(4) NOT NULL,
 APELLIDO  VARCHAR2(10),
 OFICIO    VARCHAR2(10),
 DIR       NUMBER(4),
 FECHA_ALT DATE,
 SALARIO   NUMBER(7),
 COMISION  NUMBER(7),
 DEPT_NO   NUMBER(2) NOT NULL,
CONSTRAINT PK_EMPLE PRIMARY KEY(EMP_NO),
CONSTRAINT FK_EMPLE_DEPART FOREIGN KEY(DEPT_NO) REFERENCES
DEPART ON DELETE CASCADE);

CREATE SEQUENCE SECUENCIA START WITH 10 MINVALUE 10 INCREMENT BY 10;

INSERT INTO DEPART VALUES (SECUENCIA.NEXTVAL,'CONTABILIDAD','SEVILLA');
INSERT INTO DEPART VALUES (SECUENCIA.NEXTVAL,'INVESTIGACION','MADRID');
INSERT INTO DEPART VALUES (SECUENCIA.NEXTVAL,'VENTAS','BARCELONA');
INSERT INTO DEPART VALUES (SECUENCIA.NEXTVAL,'PRODUCCION','BILBAO');
COMMIT;




INSERT INTO EMPLE VALUES (7369,'SANCHEZ','EMPLEADO',7902,'17/12/1990',1040,NULL,20);
INSERT INTO EMPLE VALUES (7499,'ARROYO','VENDEDOR',7698,'20/02/1990',1500,390,30);
INSERT INTO EMPLE VALUES (7521,'SALA','VENDEDOR',7698,'22/02/1991',1625,650,30);
INSERT INTO EMPLE VALUES (7566,'JIMENEZ','DIRECTOR',7839,'02/04/1991',2900,NULL,20);
INSERT INTO EMPLE VALUES (7654,'MARTIN','VENDEDOR',7698,'29/09/1991',1600,1020,30);
INSERT INTO EMPLE VALUES (7698,'NEGRO','DIRECTOR',7839,'01/05/1991',3005,NULL,30);
INSERT INTO EMPLE VALUES (7782,'CEREZO','DIRECTOR',7839,'09/06/1991',2885,NULL,10);
INSERT INTO EMPLE VALUES (7788,'GIL','ANALISTA',7566,'09/11/1991',3000,NULL,20);
INSERT INTO EMPLE VALUES (7839,'REY','PRESIDENTE',NULL,'17/11/1991',4100,NULL,10);
INSERT INTO EMPLE VALUES (7844,'TOVAR','VENDEDOR',7698,'08/09/1991',1350,0,30);
INSERT INTO EMPLE VALUES (7876,'ALONSO','EMPLEADO',7788,'23/09/1991',1430,NULL,20);
INSERT INTO EMPLE VALUES (7900,'JIMENO','EMPLEADO',7698,'03/12/1991',1335,NULL,30);
INSERT INTO EMPLE VALUES (7902,'FERNANDEZ','ANALISTA',7566,'03/12/1991',3000,NULL,20);
INSERT INTO EMPLE VALUES (7934,'MUï¿½OZ','EMPLEADO',7782,'23/01/1992',1690,NULL,10);

COMMIT;

CREATE OR REPLACE PROCEDURE subida_sal (d NUMBER, subida NUMBER) AS BEGIN UPDATE EMPLE SET salario=salario+subida WHERE dept_no=d;
COMMIT;
END;

CREATE OR REPLACE FUNCTION NOMBRE_DEP (d NUMBER, locali OUT VARCHAR2) RETURN VARCHAR2 AS Nom VARCHAR2(15);
BEGIN 
SELECT dnombre, loc INTO nom, locali FROM DEPART wHERE dept_no=d;
	RETURN nom;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
 		nom:='INEXISTENTE';
		RETURN nom;
END;
